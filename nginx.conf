server {
	listen 80;
	server_name *.stut.net;
	return 301 $scheme://stut.net$request_uri;
}

server {
	listen 80;
	server_name stut.net;

	location /cv {
		rewrite (.*) http://stuart.cvsite.com/ permanent;
		break;
	}
	location = /feed {
		rewrite (.*) /feed.xml permanent;
		break;
	}
	location /feed/ {
		rewrite (.*) /feed.xml permanent;
		break;
	}

	location = /2008/07/26/sessionless-sessions-2/-Stuart {
		rewrite (.*) http://stut.net/2008/07/26/sessionless-sessions-2/ permanent;
		break;
	}

	location /software/btdaemon {
		rewrite (.*) https://github.com/3ft9/btdaemon permanent;
		break;
	}

	location ~ ^/blog {
		rewrite ^/blog(.*) http://stut.net$1 permanent;
		break;
	}

	location ~ ^/projects {
		rewrite . http://stut.net/category/projects/ permanent;
		break;
	}

	# Redirects out to 3ft9.com.
	location ~ /2003/01/19/should-microsoft-build-the-next-version-of-windows-on-top-of-linux/ { rewrite ^ http://3ft9.com/should-microsoft-build-the-next-version-of-windows-on-top-of-linux/ permanent; break; }
	location ~ /2004/06/03/turn-off-wrapping-in-nano/                                          { rewrite ^ http://3ft9.com/turn-off-wrapping-in-nano/                                          permanent; break; }
	location ~ /2004/11/28/vnc-manager/                                                        { rewrite ^ http://3ft9.com/vnc-manager/                                                        permanent; break; }
	location ~ /2004/11/04/microsoft-and-mono/                                                 { rewrite ^ http://3ft9.com/microsoft-and-mono/                                                 permanent; break; }
	location ~ /2005/02/05/rename-a-mysql-database/                                            { rewrite ^ http://3ft9.com/rename-a-mysql-database/                                            permanent; break; }
	location ~ /2005/06/07/grankt-google-rank-tracker/                                         { rewrite ^ http://3ft9.com/grankt-google-rank-tracker/                                         permanent; break; }
	location ~ /2005/12/19/mysql-backup-script/                                                { rewrite ^ http://3ft9.com/mysql-backup-script/                                                permanent; break; }
	location ~ /2006/09/11/string-cracker/                                                     { rewrite ^ http://3ft9.com/string-cracker/                                                     permanent; break; }
	location ~ /2006/09/11/php-output-speed/                                                   { rewrite ^ http://3ft9.com/php-output-speed/                                                   permanent; break; }
	location ~ /2006/11/05/php-models/                                                         { rewrite ^ http://3ft9.com/php-models/                                                         permanent; break; }
	location ~ /2007/06/16/the-art-of-innovation/                                              { rewrite ^ http://3ft9.com/the-art-of-innovation/                                              permanent; break; }
	location ~ /2007/06/14/php-competition/                                                    { rewrite ^ http://3ft9.com/php-competition/                                                    permanent; break; }
	location ~ /2007/06/11/content-distribution/                                               { rewrite ^ http://3ft9.com/content-distribution/                                               permanent; break; }
	location ~ /2007/07/13/the-end-of-php-4-is-nigh/                                           { rewrite ^ http://3ft9.com/the-end-of-php-4-is-nigh/                                           permanent; break; }
	location ~ /2007/08/16/zend-acl-podcast/                                                   { rewrite ^ http://3ft9.com/zend-acl-podcast/                                                   permanent; break; }
	location ~ /2007/08/06/inconsiderate-shared-hosting-customers/                             { rewrite ^ http://3ft9.com/inconsiderate-shared-hosting-customers/                             permanent; break; }
	location ~ /2007/08/03/salamander-control-suite/                                           { rewrite ^ http://3ft9.com/salamander-control-suite/                                           permanent; break; }
	location ~ /2007/10/14/dilbert-on-experience/                                              { rewrite ^ http://3ft9.com/dilbert-on-experience/                                              permanent; break; }
	location ~ /2007/10/10/extracting-the-map-from-social-networks/                            { rewrite ^ http://3ft9.com/extracting-the-map-from-social-networks/                            permanent; break; }
	location ~ /2007/10/09/amazon-s3-sla/                                                      { rewrite ^ http://3ft9.com/amazon-s3-sla/                                                      permanent; break; }
	location ~ /2007/11/25/information-responsibility/                                         { rewrite ^ http://3ft9.com/information-responsibility/                                         permanent; break; }
	location ~ /2008/01/28/tweetmeme-launch/                                                   { rewrite ^ http://3ft9.com/tweetmeme-launch/                                                   permanent; break; }
	location ~ /2008/03/11/sessionless-sessions/                                               { rewrite ^ http://3ft9.com/sessionless-sessions/                                               permanent; break; }
	location ~ /2008/04/13/is-it-harder-to-create-usable-digital-interfaces/                   { rewrite ^ http://3ft9.com/is-it-harder-to-create-usable-digital-interfaces/                   permanent; break; }
	location ~ /2008/04/04/twitter-public-timeline/                                            { rewrite ^ http://3ft9.com/twitter-public-timeline/                                            permanent; break; }
	location ~ /2008/05/23/has-that-website-gone-titsup/                                       { rewrite ^ http://3ft9.com/has-that-website-gone-titsup/                                       permanent; break; }
	location ~ /2008/05/24/titsup-is-better-than-the-rest/                                     { rewrite ^ http://3ft9.com/titsup-is-better-than-the-rest/                                     permanent; break; }
	location ~ /2008/06/21/yet-another-url-shortener/                                          { rewrite ^ http://3ft9.com/yet-another-url-shortener/                                          permanent; break; }
	location ~ /2008/06/18/sending-email/                                                      { rewrite ^ http://3ft9.com/sending-email/                                                      permanent; break; }
	location ~ /2008/06/08/where-are-these-backslashes-coming-from/                            { rewrite ^ http://3ft9.com/where-are-these-backslashes-coming-from/                            permanent; break; }
	location ~ /2008/06/08/validating-domains-and-email-addresses/                             { rewrite ^ http://3ft9.com/validating-domains-and-email-addresses/                             permanent; break; }
	location ~ /2008/06/08/pop-unders/                                                         { rewrite ^ http://3ft9.com/pop-unders/                                                         permanent; break; }
	location ~ /2008/06/08/php-models-2/                                                       { rewrite ^ http://3ft9.com/php-models-2/                                                       permanent; break; }
	location ~ /2008/07/26/sessionless-sessions-2/                                             { rewrite ^ http://3ft9.com/sessionless-sessions-2/                                             permanent; break; }
	location ~ /2008/07/20/mysql-sessions/                                                     { rewrite ^ http://3ft9.com/mysql-sessions/                                                     permanent; break; }
	location ~ /2008/10/28/snippet-simple-templates-with-php/                                  { rewrite ^ http://3ft9.com/snippet-simple-templates-with-php/                                  permanent; break; }
	location ~ /2008/10/23/snippet-password-generator-for-php/                                 { rewrite ^ http://3ft9.com/snippet-password-generator-for-php/                                 permanent; break; }
	location ~ /2008/10/20/snippet-singletons-with-php/                                        { rewrite ^ http://3ft9.com/snippet-singletons-with-php/                                        permanent; break; }
	location ~ /2008/10/17/snippet-time-class-for-php/                                         { rewrite ^ http://3ft9.com/snippet-time-class-for-php/                                         permanent; break; }
	location ~ /2008/10/16/snippet-cookie-class-for-php/                                       { rewrite ^ http://3ft9.com/snippet-cookie-class-for-php/                                       permanent; break; }
	location ~ /2008/10/15/snippet-page-expiry-in-php/                                         { rewrite ^ http://3ft9.com/snippet-page-expiry-in-php/                                         permanent; break; }
	location ~ /2008/10/13/requiring_unnecessary_information/                                  { rewrite ^ http://3ft9.com/requiring_unnecessary_information/                                  permanent; break; }
	location ~ /2008/12/17/twitorfit/                                                          { rewrite ^ http://3ft9.com/twitorfit/                                                          permanent; break; }
	location ~ /2009/01/31/twitter-unfollows-too-much-information/                             { rewrite ^ http://3ft9.com/twitter-unfollows-too-much-information/                             permanent; break; }
	location ~ /2009/01/24/oauth-and-twitter-realistic-expectations/                           { rewrite ^ http://3ft9.com/oauth-and-twitter-realistic-expectations/                           permanent; break; }
	location ~ /2009/03/08/handling-email-notifications-from-twitter/                          { rewrite ^ http://3ft9.com/handling-email-notifications-from-twitter/                          permanent; break; }
	location ~ /2009/05/29/php-job-queue/                                                      { rewrite ^ http://3ft9.com/php-job-queue/                                                      permanent; break; }
	location ~ /2010/02/19/tweetmeme-live-test-video-from-april-2009/                          { rewrite ^ http://3ft9.com/tweetmeme-live-test-video-from-april-2009/                          permanent; break; }
	location ~ /2010/06/25/the-importance-of-nice-urls/                                        { rewrite ^ http://3ft9.com/the-importance-of-nice-urls/                                        permanent; break; }
	location ~ /2011/02/28/jack-dorsey-on-entrepreneurship/                                    { rewrite ^ http://3ft9.com/jack-dorsey-on-entrepreneurship/                                    permanent; break; }
	location ~ /2011/03/13/twitter-tos-changes/                                                { rewrite ^ http://3ft9.com/twitter-tos-changes/                                                permanent; break; }
	location ~ /2011/04/12/php-snippet-array-element-access/                                   { rewrite ^ http://3ft9.com/php-snippet-array-element-access/                                   permanent; break; }
	location ~ /2011/08/06/introducing-furl/                                                   { rewrite ^ http://3ft9.com/introducing-furl/                                                   permanent; break; }
	location ~ /2011/08/16/fortunes-tower-in-php/                                              { rewrite ^ http://3ft9.com/fortunes-tower-in-php/                                              permanent; break; }
	location ~ /2011/09/27/rackspace-cloudfiles-plugin-for-jekyll/                             { rewrite ^ http://3ft9.com/rackspace-cloudfiles-plugin-for-jekyll/                             permanent; break; }
	location ~ /2011/09/15/mysql-real-escape-string-is-not-enough/                             { rewrite ^ http://3ft9.com/mysql-real-escape-string-is-not-enough/                             permanent; break; }
	location ~ /2011/11/12/handling-email-notifications/                                       { rewrite ^ http://3ft9.com/handling-email-notifications/                                       permanent; break; }
	location ~ /2012/11/11/snippet-http-authentication/                                        { rewrite ^ http://3ft9.com/snippet-http-authentication/                                        permanent; break; }
	location ~ /2012/12/03/template-based-dns-zone-management/                                 { rewrite ^ http://3ft9.com/template-based-dns-zone-management/                                 permanent; break; }

	location / {
		root   /var/www/stut.net/www;
		index  index.html;

		# this serves static files that exist without running other rewrite tests
		if (-f $request_filename) {
			expires 30d;
			break;
		}
	}
}
